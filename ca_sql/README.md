## CA Documentation

https://manual.collectiveaccess.org/dataModelling/primaryTables.html#entities-ca-entities

## CA Tables
- ca_acl
- ca_application_vars
- ca_attribute_value_multifiles
- ca_batch_log
- ca_batch_log_items
- ca_bookmark_folders
- ca_bookmarks
- ca_bundle_display_labels
- ca_bundle_display_placements
- ca_bundle_display_type_restrictions
- ca_bundle_displays
- ca_bundle_displays_x_user_groups
- ca_bundle_displays_x_users
- ca_change_log
- ca_change_log_snapshots
- ca_change_log_subjects
- ca_collection_labels
- ca_collections
- ca_collections_x_collections
- ca_collections_x_storage_locations
- ca_collections_x_vocabulary_terms
- ca_data_exporter_items
- ca_data_exporter_labels
- ca_data_exporters
- ca_data_import_event_log
- ca_data_import_events
- ca_data_import_items
- ca_data_importer_groups
- ca_data_importer_items
- ca_data_importer_labels
- ca_data_importer_log
- ca_data_importer_log_items
- ca_data_importers
- ca_download_log
- ca_editor_ui_bundle_placements
- ca_editor_ui_labels
- ca_editor_ui_screen_labels
- ca_editor_ui_screen_type_restrictions
- ca_editor_ui_screens
- ca_editor_ui_screens_x_roles
- ca_editor_ui_screens_x_user_groups
- ca_editor_ui_screens_x_users
- ca_editor_ui_type_restrictions
- ca_editor_uis
- ca_editor_uis_x_roles
- ca_editor_uis_x_user_groups
- ca_editor_uis_x_users
- ca_entities
- ca_entities_x_collections
- ca_entities_x_entities
- ca_entities_x_occurrences
- ca_entities_x_places
- ca_entities_x_storage_locations
- ca_entities_x_vocabulary_terms
- ca_entity_labels
- ca_eventlog
- ca_groups_x_roles
- ca_guids
- ca_history_tracking_current_values
- ca_ips
- ca_item_comments
- ca_item_tags
- ca_items_x_tags
- ca_list_item_labels
- ca_list_items
- ca_list_items_x_list_items
- ca_list_labels
- ca_lists
- ca_loan_labels
- ca_loans
- ca_loans_x_collections
- ca_loans_x_entities
- ca_loans_x_loans
- ca_loans_x_movements
- ca_loans_x_object_lots
- ca_loans_x_object_representations
- ca_loans_x_objects
- ca_loans_x_occurrences
- ca_loans_x_places
- ca_loans_x_storage_locations
- ca_loans_x_vocabulary_terms
- ca_locales
- ca_media_content_locations
- ca_media_replication_status_check
- ca_metadata_alert_rule_labels
- ca_metadata_alert_rule_type_restrictions
- ca_metadata_alert_rules
- ca_metadata_alert_rules_x_user_groups
- ca_metadata_alert_rules_x_users
- ca_metadata_alert_triggers
- ca_metadata_dictionary_entries
- ca_metadata_dictionary_entry_labels
- ca_metadata_dictionary_rule_violations
- ca_metadata_dictionary_rules
- ca_metadata_element_labels
- ca_metadata_elements
- ca_metadata_type_restrictions
- ca_movement_labels
- ca_movements
- ca_movements_x_collections
- ca_movements_x_entities
- ca_movements_x_movements
- ca_movements_x_object_lots
- ca_movements_x_object_representations
- ca_movements_x_objects
- ca_movements_x_occurrences
- ca_movements_x_places
- ca_movements_x_storage_locations
- ca_movements_x_vocabulary_terms
- ca_multipart_idno_sequences
- ca_notification_subjects
- ca_notifications
- ca_object_checkouts
- ca_object_labels
- ca_object_lot_labels
- ca_object_lots
- ca_object_lots_x_collections
- ca_object_lots_x_entities
- ca_object_lots_x_object_lots
- ca_object_lots_x_object_representations
- ca_object_lots_x_occurrences
- ca_object_lots_x_places
- ca_object_lots_x_storage_locations
- ca_object_lots_x_vocabulary_terms
- ca_object_representation_captions
- ca_object_representation_labels
- ca_object_representation_multifiles
- ca_object_representations
- ca_object_representations_x_collections
- ca_object_representations_x_entities
- ca_object_representations_x_object_representations
- ca_object_representations_x_occurrences
- ca_object_representations_x_places
- ca_object_representations_x_storage_locations
- ca_object_representations_x_vocabulary_terms
- ca_objects
- ca_objects_x_collections
- ca_objects_x_entities
- ca_objects_x_object_representations
- ca_objects_x_objects
- ca_objects_x_occurrences
- ca_objects_x_places
- ca_objects_x_storage_locations
- ca_objects_x_vocabulary_terms
- ca_occurrence_labels
- ca_occurrences
- ca_occurrences_x_collections
- ca_occurrences_x_occurrences
- ca_occurrences_x_storage_locations
- ca_occurrences_x_vocabulary_terms
- ca_persistent_cache
- ca_place_labels
- ca_places
- ca_places_x_collections
- ca_places_x_occurrences
- ca_places_x_places
- ca_places_x_storage_locations
- ca_places_x_vocabulary_terms
- ca_relationship_relationships
- ca_relationship_type_labels
- ca_relationship_types
- ca_replication_log
- ca_representation_annotation_labels
- ca_representation_annotations
- ca_representation_annotations_x_entities
- ca_representation_annotations_x_objects
- ca_representation_annotations_x_occurrences
- ca_representation_annotations_x_places
- ca_representation_annotations_x_vocabulary_terms
- ca_schema_updates
- ca_search_form_labels
- ca_search_form_placements
- ca_search_form_type_restrictions
- ca_search_forms
- ca_search_forms_x_user_groups
- ca_search_forms_x_users
- ca_search_indexing_queue
- ca_search_log
- ca_set_item_labels
- ca_set_items
- ca_set_labels
- ca_sets
- ca_sets_x_user_groups
- ca_sets_x_users
- ca_site_page_media
- ca_site_pages
- ca_site_templates
- ca_sql_search_ngrams
- ca_sql_search_word_index
- ca_sql_search_words
- ca_storage_location_labels
- ca_storage_locations
- ca_storage_locations_x_storage_locations
- ca_storage_locations_x_vocabulary_terms
- ca_task_queue
- ca_tour_labels
- ca_tour_stop_labels
- ca_tour_stops
- ca_tour_stops_x_collections
- ca_tour_stops_x_entities
- ca_tour_stops_x_objects
- ca_tour_stops_x_occurrences
- ca_tour_stops_x_places
- ca_tour_stops_x_tour_stops
- ca_tour_stops_x_vocabulary_terms
- ca_tours
- ca_user_groups
- ca_user_notes
- ca_user_representation_annotation_labels
- ca_user_representation_annotations
- ca_user_representation_annotations_x_entities
- ca_user_representation_annotations_x_objects
- ca_user_representation_annotations_x_occurrences
- ca_user_representation_annotations_x_places
- ca_user_representation_annotations_x_vocabulary_terms
- ca_user_roles
- ca_user_sort_items
- ca_user_sorts
- ca_users
- ca_users_x_groups
- ca_users_x_roles
- ca_watch_list
- datemp_table
- temptable

---

```
+----------------------------------------------+
| TABLE_NAME                                   |
+----------------------------------------------+
| ca_loans_x_objects                           |
| ca_movements_x_objects                       |
| ca_object_checkouts                          |
| ca_object_labels                             |
| ca_objects                                   |
| ca_objects_x_collections                     |
| ca_objects_x_entities                        |
| ca_objects_x_object_representations          |
| ca_objects_x_occurrences                     |
| ca_objects_x_places                          |
| ca_objects_x_storage_locations               |
| ca_objects_x_vocabulary_terms                |
| ca_representation_annotations_x_objects      |
| ca_tour_stops_x_objects                      |
| ca_user_representation_annotations_x_objects |
| datemp_table                                 |
| temptable                                    |
+----------------------------------------------+
```

## Object labels

```
MySQL [da_ca]> select locale_id, count(*) from ca_object_labels group by locale_id;
+-----------+----------+
| locale_id | count(*) |
+-----------+----------+
|         1 |   168057 |
|         6 |     1131 |
|        11 |        3 |
|        15 |   160318 |
|        21 |        2 |
+-----------+----------+
5 rows in set (0.15 sec)

MySQL [da_ca]> select * from ca_locales;
+-----------+-----------------------+----------+---------+---------+--------------------------+
| locale_id | name                  | language | country | dialect | dont_use_for_cataloguing |
+-----------+-----------------------+----------+---------+---------+--------------------------+
|         1 | English (US)          | en       | US      | 2       |                        0 |
|         2 | English (Canadian)    | en       | CA      | NULL    |                        1 |
|         3 | English (Australian)  | en       | AU      | 2       |                        1 |
|         4 | Deutsch (Deutschland) | de       | DE      | NULL    |                        1 |
|         5 | Deutsch (Österreich)  | de       | AT      | NULL    |                        1 |
|         6 | Français              | fr       | FR      | 5       |                        0 |
|         7 | Français (Canadien)   | fr       | CA      | NULL    |                        1 |
|         8 | Czech                 | cs       | CZ      | NULL    |                        1 |
|         9 | Greek                 | el       | GR      | NULL    |                        1 |
|        10 | Español               | es       | ES      | NULL    |                        1 |
|        11 | Italiano              | it       | IT      | NULL    |                        1 |
|        12 | Nederlands            | nl       | NL      | NULL    |                        1 |
|        13 | Serbian               | sr       | RS      | NULL    |                        1 |
|        14 | Svenska               | sv       | SE      | NULL    |                        1 |
|        15 | Arabic                | ar       | PS      | 1       |                        0 |
|        16 | Hebrew                | heb      | he      | NULL    |                        1 |
|        18 | Undetermined          | und      |         | NULL    |                        1 |
|        19 | Syriac                | syr      |         | NULL    |                        1 |
|        20 | No linguistic content | zxx      |         | NULL    |                        1 |
|        21 | Turkish, Ottoman      | ota      |         | NULL    |                        1 |
+-----------+-----------------------+----------+---------+---------+--------------------------+
20 rows in set (0.00 sec)
```

## ERC Queries

```
select
  idno,
  object_id,
  case
    when title_eng is null 
      then replace(replace(title_arb, '\n', ''), '\t', '')
    else replace(replace(title_eng, '\n', ''), '\t', '')
  end as erc_what,
  case
    when creator_eng_first is not null then creator_eng_first
    when creator_arb_first is not null then creator_arb_first
    when publisher_eng is not null then publisher_eng
    when publisher_arb is not null then publisher_arb
    when contributor_eng is not null then contributor_eng
    when contributor_arb is not null then contributor_arb
    when source_eng is not null then source_eng
    when source_arb is not null then source_arb
  end as erc_who,
  case
    when creator_eng is null then creator_arb
    else creator_eng
  end as creator,
  case
    when publisher_eng is null then publisher_arb
    else publisher_eng
  end as publisher,
  case
    when contributor_eng is null then contributor_arb
    else contributor_eng
  end as contributor,
  case
    when source_eng is null then source_arb
    else source_eng
  end as source
from (
  select
    trim(o.idno) as idno,
    o.object_id,
    (select trim(group_concat(ol.name separator '; ')) from ca_object_labels ol where ol.object_id = o.object_id and ol.locale_id = 1) as title_eng,
    (select trim(group_concat(ol.name separator '; ')) from ca_object_labels ol where ol.object_id = o.object_id and ol.locale_id = 15) as title_arb,
    (
      select trim(l.displayname) 
      from ca_entity_labels l
      inner join ca_objects_x_entities oe 
      on oe.entity_id = l.entity_id
      where oe.object_id = o.object_id and oe.type_id=100 and l.locale_id = 1
      limit 1
    ) as creator_eng_first,
    (
      select trim(l.displayname) 
      from ca_entity_labels l
      inner join ca_objects_x_entities oe 
      on oe.entity_id = l.entity_id
      where oe.object_id = o.object_id and oe.type_id=100 and l.locale_id = 15
      limit 1
    ) as creator_arb_first,
    (
      select trim(group_concat(l.displayname separator '; ')) 
      from ca_entity_labels l
      inner join ca_objects_x_entities oe 
      on oe.entity_id = l.entity_id
      where oe.object_id = o.object_id and oe.type_id=100 and l.locale_id = 1
    ) as creator_eng,
    (
      select trim(group_concat(l.displayname separator '; ')) 
      from ca_entity_labels l
      inner join ca_objects_x_entities oe 
      on oe.entity_id = l.entity_id
      where oe.object_id = o.object_id and oe.type_id=100 and l.locale_id = 15
    ) as creator_arb,
    (
      select trim(group_concat(l.displayname separator '; ')) 
      from ca_entity_labels l
      inner join ca_objects_x_entities oe 
      on oe.entity_id = l.entity_id
      where oe.object_id = o.object_id and oe.type_id=101 and l.locale_id = 1
    ) as publisher_eng,
    (
      select trim(group_concat(l.displayname separator '; ')) 
      from ca_entity_labels l
      inner join ca_objects_x_entities oe 
      on oe.entity_id = l.entity_id
      where oe.object_id = o.object_id and oe.type_id=101 and l.locale_id = 15
    ) as publisher_arb,
    (
      select trim(group_concat(l.displayname separator '; ')) 
      from ca_entity_labels l
      inner join ca_objects_x_entities oe 
      on oe.entity_id = l.entity_id
      where oe.object_id = o.object_id and oe.type_id=102 and l.locale_id = 1
    ) as contributor_eng,
    (
      select trim(group_concat(l.displayname separator '; ')) 
      from ca_entity_labels l
      inner join ca_objects_x_entities oe 
      on oe.entity_id = l.entity_id
      where oe.object_id = o.object_id and oe.type_id=102 and l.locale_id = 15
    ) as contributor_arb,
    (
      select trim(group_concat(l.displayname separator '; ')) 
      from ca_entity_labels l
      inner join ca_objects_x_entities oe 
      on oe.entity_id = l.entity_id
      where oe.object_id = o.object_id and oe.type_id=103 and l.locale_id = 1
    ) as source_eng,
    (
      select trim(group_concat(l.displayname separator '; ')) 
      from ca_entity_labels l
      inner join ca_objects_x_entities oe 
      on oe.entity_id = l.entity_id
      where oe.object_id = o.object_id and oe.type_id=103 and l.locale_id = 15
    ) as source_arb
    from
      ca_objects o
    where idno != ''
) as extract
order by idno;
```


```

## Entity Queries - erc_who?

```
select distinct entity_id, displayname from ca_entity_labels;
```



select 
  l.entity_id,
  l.locale_id,
  l.displayname,
  oe.type_id
from
  ca_entity_labels l
inner join
  ca_objects_x_entities oe
on
  oe.entity_id = l.entity_id
inner join
  ca_objects o
on
  o.object_id = oe.object_id
where
  o.idno = '0001.01.0011';
```


## Understanding type relationships

```
select
  t.type_id,
  t.type_code,
  count(*)
from 
  ca_relationship_types t
inner join
  ca_objects_x_entities oe
on
  oe.type_id = t.type_id
group by
  t.type_id,
  t.type_code;
```

```
+---------+-------------+----------+
| type_id | type_code   | count(*) |
+---------+-------------+----------+
|     100 | creator     |    79930 |
|     101 | publisher   |     5226 |
|     102 | contributor |    53626 |
|     103 | source      |    38375 |
|     179 | tag         |   211128 |
|     181 | Subject.e   |    48695 |
+---------+-------------+----------+
```

select 
  distinct l.displayname 
from
  ca_entity_labels l
inner join
  ca_objects_x_entities oe 
on
  oe.entity_id = l.entity_id
where 
  oe.type_id=100;
```

## ca_objects

```
MySQL [da_ca]> describe ca_objects;
+---------------------------------+-------------------------+------+-----+---------+----------------+
| Field                           | Type                    | Null | Key | Default | Extra          |
+---------------------------------+-------------------------+------+-----+---------+----------------+
| object_id                       | int unsigned            | NO   | PRI | NULL    | auto_increment |
| parent_id                       | int unsigned            | YES  | MUL | NULL    |                |
| lot_id                          | int unsigned            | YES  | MUL | NULL    |                |
| locale_id                       | smallint unsigned       | YES  | MUL | NULL    |                |
| source_id                       | int unsigned            | YES  | MUL | NULL    |                |
| is_template                     | tinyint unsigned        | NO   |     | 0       |                |
| commenting_status               | tinyint unsigned        | NO   |     | 0       |                |
| tagging_status                  | tinyint unsigned        | NO   |     | 0       |                |
| rating_status                   | tinyint unsigned        | NO   |     | 0       |                |
| view_count                      | int unsigned            | NO   | MUL | 0       |                |
| type_id                         | int unsigned            | NO   | MUL | NULL    |                |
| idno                            | varchar(255)            | NO   | MUL | NULL    |                |
| idno_sort                       | varchar(255)            | NO   | MUL | NULL    |                |
| acquisition_type_id             | int unsigned            | YES  | MUL | NULL    |                |
| item_status_id                  | int unsigned            | YES  | MUL | NULL    |                |
| source_info                     | longtext                | NO   |     | NULL    |                |
| hier_object_id                  | int unsigned            | NO   | MUL | NULL    |                |
| hier_left                       | decimal(30,20) unsigned | NO   | MUL | NULL    |                |
| hier_right                      | decimal(30,20) unsigned | NO   | MUL | NULL    |                |
| extent                          | int unsigned            | NO   |     | NULL    |                |
| extent_units                    | varchar(255)            | NO   |     | NULL    |                |
| access                          | tinyint unsigned        | NO   |     | 0       |                |
| status                          | tinyint unsigned        | NO   |     | 0       |                |
| deleted                         | tinyint unsigned        | NO   |     | 0       |                |
| rank                            | int unsigned            | NO   |     | 0       |                |
| acl_inherit_from_ca_collections | tinyint unsigned        | NO   | MUL | 0       |                |
| acl_inherit_from_parent         | tinyint unsigned        | NO   | MUL | 0       |                |
| access_inherit_from_parent      | tinyint unsigned        | NO   |     | 0       |                |
| home_location_id                | int unsigned            | YES  | MUL | NULL    |                |
| accession_sdatetime             | decimal(30,20)          | YES  | MUL | NULL    |                |
| accession_edatetime             | decimal(30,20)          | YES  | MUL | NULL    |                |
| deaccession_sdatetime           | decimal(30,20)          | YES  | MUL | NULL    |                |
| deaccession_edatetime           | decimal(30,20)          | YES  | MUL | NULL    |                |
| is_deaccessioned                | tinyint                 | NO   | MUL | 0       |                |
| deaccession_notes               | text                    | NO   |     | NULL    |                |
| deaccession_type_id             | int unsigned            | YES  | MUL | NULL    |                |
| current_loc_class               | tinyint unsigned        | YES  | MUL | NULL    |                |
| current_loc_subclass            | int unsigned            | YES  | MUL | NULL    |                |
| current_loc_id                  | int unsigned            | YES  | MUL | NULL    |                |
| circulation_status_id           | int unsigned            | YES  | MUL | NULL    |                |
| deaccession_disposal_sdatetime  | decimal(30,20)          | YES  | MUL | NULL    |                |
| deaccession_disposal_edatetime  | decimal(30,20)          | YES  | MUL | NULL    |                |
+---------------------------------+-------------------------+------+-----+---------+----------------+
42 rows in set (0.00 sec)

MySQL [da_ca]> select idno from ca_objects limit 10;
+---------------+
| idno          |
+---------------+
|               |
|  0157.01.0019 |
| 0001.01.0001  |
| 0001.01.0002  |
| 0001.01.0003  |
| 0001.01.0004  |
| 0001.01.0005  |
| 0001.01.0006  |
| 0001.01.0007  |
| 0001.01.0008  |
+---------------+
10 rows in set (0.00 sec)

MySQL [da_ca]> select * from ca_objects limit 1;
+-----------+-----------+--------+-----------+-----------+-------------+-------------------+----------------+---------------+------------+---------+--------------+--------------------------------------------------------------------------------------------------------------------------+---------------------+----------------+-------------+----------------+------------------------+--------------------------+--------+--------------+--------+--------+---------+------+---------------------------------+-------------------------+----------------------------+------------------+---------------------+---------------------+-----------------------+-----------------------+------------------+-------------------+---------------------+-------------------+----------------------+----------------+-----------------------+--------------------------------+--------------------------------+
| object_id | parent_id | lot_id | locale_id | source_id | is_template | commenting_status | tagging_status | rating_status | view_count | type_id | idno         | idno_sort                                                                                                                | acquisition_type_id | item_status_id | source_info | hier_object_id | hier_left              | hier_right               | extent | extent_units | access | status | deleted | rank | acl_inherit_from_ca_collections | acl_inherit_from_parent | access_inherit_from_parent | home_location_id | accession_sdatetime | accession_edatetime | deaccession_sdatetime | deaccession_edatetime | is_deaccessioned | deaccession_notes | deaccession_type_id | current_loc_class | current_loc_subclass | current_loc_id | circulation_status_id | deaccession_disposal_sdatetime | deaccession_disposal_edatetime |
+-----------+-----------+--------+-----------+-----------+-------------+-------------------+----------------+---------------+------------+---------+--------------+--------------------------------------------------------------------------------------------------------------------------+---------------------+----------------+-------------+----------------+------------------------+--------------------------+--------+--------------+--------+--------+---------+------+---------------------------------+-------------------------+----------------------------+------------------+---------------------+---------------------+-----------------------+-----------------------+------------------+-------------------+---------------------+-------------------+----------------------+----------------+-----------------------+--------------------------------+--------------------------------+
|        13 |      NULL |   NULL |      NULL |      NULL |           0 |                 0 |              0 |             0 |          3 |      24 | 0001.01.0001 |                 0001                                      01                                    0001                     |                  43 |           NULL | Tjs=        |             13 | 1.00000000000000000000 | 101.00000000000000000000 |      0 |              |      1 |      5 |       0 |   13 |                               0 |                       0 |                          0 |             NULL |                NULL |                NULL |                  NULL |                  NULL |                0 |                   |                NULL |              NULL |                 NULL |           NULL |                  NULL |                           NULL |                           NULL |
+-----------+-----------+--------+-----------+-----------+-------------+-------------------+----------------+---------------+------------+---------+--------------+--------------------------------------------------------------------------------------------------------------------------+---------------------+----------------+-------------+----------------+------------------------+--------------------------+--------+--------------+--------+--------+---------+------+---------------------------------+-------------------------+----------------------------+------------------+---------------------+---------------------+-----------------------+-----------------------+------------------+-------------------+---------------------+-------------------+----------------------+----------------+-----------------------+--------------------------------+--------------------------------+
1 row in set (0.01 sec)
```

